#!/bin/sh
set -e
ARCH=$(uname -m)
if [ "${ARCH#arm}" != "${ARCH}" ] ; then
  # Fix kernel oops by locking CPU frequency
  # https://github.com/maemo-leste/bugtracker/issues/212
  GOVERNOR=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor)
  echo performance > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
  modprobe pvrsrvkm
  echo $GOVERNOR > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor

  @prefix@/sbin/pvrsrvinit
  modprobe omaplfb
  chgrp video /dev/pvrsrvkm
  chmod 660 /dev/pvrsrvkm
fi
[ -x /bin/systemd-notify ] && exec /bin/systemd-notify --ready
exit 0
